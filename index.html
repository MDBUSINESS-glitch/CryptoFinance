<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CryptoFinance Pro - EMAs, RSI e Bollinger Bands</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css">
  <style>
    body{background:#111;color:#fff;font-family:'Segoe UI',sans-serif;margin:0;}
    nav{position:fixed;top:0;left:0;width:100%;background:#000;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;}
    nav .logo{color:#FFD700;font-weight:bold;font-size:1.4rem;}
    nav ul{list-style:none;display:flex;gap:1.5rem;}
    nav ul li a{color:#fff;text-decoration:none;font-weight:600;}
    nav ul li a:hover{color:#FFD700;}
    section{padding:5rem 2rem;max-width:1200px;margin:auto;}
    h2{text-align:center;color:#FFD700;margin-bottom:1.5rem;}
    button{margin:3px;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;background:#FFD700;color:#000;font-weight:bold;}
    button:hover{background:#FFAA00;}
    footer{text-align:center;padding:1.5rem;background:#000;color:#aaa;font-size:.9rem;}
    canvas{background:#1a1a1a;border-radius:10px;padding:1rem;margin-bottom:1rem;}
    .options{text-align:center;margin-bottom:10px;}
    .options label{margin:0 10px;cursor:pointer;}
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="logo">CryptoFinance Pro</div>
    <ul>
      <li><a href="#ema9-20">‚ö° EMA9 x EMA20</a></li>
      <li><a href="#ema50-200">üè¶ EMA50 x EMA200</a></li>
    </ul>
  </nav>

  <!-- Hero -->
  <section class="hero">
    <h1 style="text-align:center;">üìä Trading Dashboard: EMAs + RSI + Bollinger</h1>
    <p style="text-align:center;">Agora podes ativar/desativar indicadores para personalizar a an√°lise!</p>
  </section>

  <!-- CURTO PRAZO -->
  <section id="ema9-20">
    <h2>‚ö° Curto Prazo (EMA9 x EMA20)</h2>

    <div class="options">
      <label><input type="checkbox" class="toggle" value="ema" checked> Mostrar EMAs</label>
      <label><input type="checkbox" class="toggle" value="boll" checked> Mostrar Bollinger</label>
      <label><input type="checkbox" class="toggle" value="rsi" checked> Mostrar RSI</label>
    </div>

    <h3>Bitcoin</h3>
    <canvas id="btcChart9"></canvas><canvas id="btcRSI9" height="100"></canvas>
    <h3>Ethereum</h3>
    <canvas id="ethChart9"></canvas><canvas id="ethRSI9" height="100"></canvas>
    <h3>Solana</h3>
    <canvas id="solChart9"></canvas><canvas id="solRSI9" height="100"></canvas>
    <div style="text-align:center;margin-top:20px;">
      <button onclick="loadCharts9('1')">‚è≥ 24h</button>
      <button onclick="loadCharts9('7')">üìÖ 7 dias</button>
      <button onclick="loadCharts9('30')">üìà 30 dias</button>
    </div>
  </section>

  <!-- LONGO PRAZO -->
  <section id="ema50-200">
    <h2>üè¶ Longo Prazo (EMA50 x EMA200)</h2>

    <div class="options">
      <label><input type="checkbox" class="toggleLP" value="ema" checked> Mostrar EMAs</label>
      <label><input type="checkbox" class="toggleLP" value="boll" checked> Mostrar Bollinger</label>
      <label><input type="checkbox" class="toggleLP" value="rsi" checked> Mostrar RSI</label>
    </div>

    <h3>Bitcoin</h3>
    <canvas id="btcChart50"></canvas><canvas id="btcRSI50" height="100"></canvas>
    <h3>Ethereum</h3>
    <canvas id="ethChart50"></canvas><canvas id="ethRSI50" height="100"></canvas>
    <h3>Solana</h3>
    <canvas id="solChart50"></canvas><canvas id="solRSI50" height="100"></canvas>
    <div style="text-align:center;margin-top:20px;">
      <button onclick="loadCharts50('90')">üìÖ 90 dias</button>
      <button onclick="loadCharts50('180')">üìÜ 6 meses</button>
      <button onclick="loadCharts50('365')">üìÜ 1 ano</button>
    </div>
  </section>

  <footer>
    ¬© 2025 CryptoFinance Pro - Todos os direitos reservados.
  </footer>

  <!-- Chart.js + Plugin de Anota√ß√£o -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
  <script>
    let showEMA=true, showBoll=true, showRSI=true;
    let showEMA_LP=true, showBoll_LP=true, showRSI_LP=true;

    // Calcular EMA
    function calcEMA(values, period){
      let k=2/(period+1), ema=[values[0]];
      for(let i=1;i<values.length;i++){ ema.push(values[i]*k+ema[i-1]*(1-k)); }
      return ema;
    }

    // RSI
    function calcRSI(values, period=14){
      let rsi=[], gains=0, losses=0;
      for(let i=1;i<values.length;i++){
        let change=values[i]-values[i-1];
        gains+=change>0?change:0;
        losses+=change<0?-change:0;
        if(i>=period){
          if(i>period){
            let ch=values[i]-values[i-1];
            gains=(gains*(period-1)+(ch>0?ch:0))/period;
            losses=(losses*(period-1)+(ch<0?-ch:0))/period;
          }else{gains/=period; losses/=period;}
          let rs=losses===0?100:gains/losses;
          rsi.push(100-(100/(1+rs)));
        }else rsi.push(null);
      }
      return rsi;
    }

    // Bollinger Bands
    function calcBollinger(values, period=20, mult=2){
      let sma=[], upper=[], lower=[];
      for(let i=0;i<values.length;i++){
        if(i<period){sma.push(null);upper.push(null);lower.push(null);}
        else{
          let slice=values.slice(i-period,i);
          let avg=slice.reduce((a,b)=>a+b,0)/period;
          let variance=slice.reduce((a,b)=>a+Math.pow(b-avg,2),0)/period;
          let stdev=Math.sqrt(variance);
          sma.push(avg); upper.push(avg+mult*stdev); lower.push(avg-mult*stdev);
        }
      }
      return {sma,upper,lower};
    }

    async function getData(coin, days){
      const res=await fetch(`https://api.coingecko.com/api/v3/coins/${coin}/market_chart?vs_currency=usd&days=${days}`);
      const data=await res.json();
      return {
        prices:data.prices.map(p=>p[1]),
        labels:data.prices.map(p=>new Date(p[0]).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}))
      };
    }

    async function renderChart(ctxP, ctxR, coin, days, label, fastEMA, slowEMA, opts){
      const data=await getData(coin,days);
      let emaF=calcEMA(data.prices,fastEMA), emaS=calcEMA(data.prices,slowEMA);
      let buy=[],sell=[];
      for(let i=1;i<data.prices.length;i++){
        if(emaF[i-1]<emaS[i-1] && emaF[i]>emaS[i]) buy.push({x:data.labels[i],y:data.prices[i]});
        if(emaF[i-1]>emaS[i-1] && emaF[i]<emaS[i]) sell.push({x:data.labels[i],y:data.prices[i]});
      }
      let boll=calcBollinger(data.prices,20,2);

      // Price Chart
      new Chart(ctxP,{
        type:'line',
        data:{labels:data.labels,datasets:[
          {label:label+" Pre√ßo",data:data.prices,borderColor:"#FFD700",pointRadius:0},
          ...(opts.ema?[{label:`EMA${fastEMA}`,data:emaF,borderColor:"#0f0",borderDash:[5,5],pointRadius:0},{label:`EMA${slowEMA}`,data:emaS,borderColor:"#00BFFF",borderDash:[5,5],pointRadius:0}]:[]),
          ...(opts.boll?[{label:"BB Upper",data:boll.upper,borderColor:"rgba(255,0,0,0.5)",pointRadius:0},{label:"BB Middle",data:boll.sma,borderColor:"rgba(200,200,200,0.6)",borderDash:[2,2],pointRadius:0},{label:"BB Lower",data:boll.lower,borderColor:"rgba(0,255,0,0.5)",pointRadius:0}]:[]),
          {label:"Buy",data:buy,borderColor:"#0f0",backgroundColor:"#0f0",pointRadius:6,showLine:false},
          {label:"Sell",data:sell,borderColor:"#f00",backgroundColor:"#f00",pointRadius:6,showLine:false}
        ]},
        options:{plugins:{legend:{labels:{color:"#FFF"}}},scales:{x:{ticks:{color:"#FFF"}},y:{ticks:{color:"#FFF"}}}}
      });

      // RSI Chart (opcional)
      if(opts.rsi){
        const rsi = calcRSI(data.prices,14);
        new Chart(ctxR,{
          type:"line",
          data:{labels:data.labels,datasets:[{label:"RSI(14)",data:rsi,borderColor:"#FF00FF",fill:false}]},
          options:{
            plugins:{
              legend:{labels:{color:"#FFF"}},
              annotation:{
                annotations:{
                  overbought:{type:"box",yMin:70,yMax:100,backgroundColor:"rgba(255,0,0,0.15)"},
                  oversold:{type:"box",yMin:0,yMax:30,backgroundColor:"rgba(0,255,0,0.15)"},
                  l1:{type:"line",yMin:70,yMax:70,borderColor:"red",borderWidth:1},
                  l2:{type:"line",yMin:30,yMax:30,borderColor:"green",borderWidth:1}
                }
              }
            },
            scales:{y:{min:0,max:100,ticks:{color:"#FFF"}},x:{ticks:{color:"#FFF"}}}
          }
        });
      }else{
        ctxR.style.display="none";
      }
    }

    function loadCharts9(days){
      renderChart(document.getElementById("btcChart9"),document.getElementById("btcRSI9"),"bitcoin",days,"BTC",9,20,{ema:showEMA,boll:showBoll,rsi:showRSI});
      renderChart(document.getElementById("ethChart9"),document.getElementById("ethRSI9"),"ethereum",days,"ETH",9,20,{ema:showEMA,boll:showBoll,rsi:showRSI});
      renderChart(document.getElementById("solChart9"),document.getElementById("solRSI9"),"solana",days,"SOL",9,20,{ema:showEMA,boll:showBoll,rsi:showRSI});
    }
    function loadCharts50(days){
      renderChart(document.getElementById("btcChart50"),document.getElementById("btcRSI50"),"bitcoin",days,"BTC",50,200,{ema:showEMA_LP,boll:showBoll_LP,rsi:showRSI_LP});
      renderChart(document.getElementById("ethChart50"),document.getElementById("ethRSI50"),"ethereum",days,"ETH",50,200,{ema:showEMA_LP,boll:showBoll_LP,rsi:showRSI_LP});
      renderChart(document.getElementById("solChart50"),document.getElementById("solRSI50"),"solana",days,"SOL",50,200,{ema:showEMA_LP,boll:showBoll_LP,rsi:showRSI_LP});
    }

    // Inicial
    loadCharts9("7");
    loadCharts50("180");

    // Listeners para checkboxes
    document.querySelectorAll(".toggle").forEach(cb=>{
      cb.addEventListener("change",()=>{
        showEMA=document.querySelector(".toggle[value='ema']").checked;
        showBoll=document.querySelector(".toggle[value='boll']").checked;
        showRSI=document.querySelector(".toggle[value='rsi']").checked;
        loadCharts9("7");
      });
    });
    document.querySelectorAll(".toggleLP").forEach(cb=>{
      cb.addEventListener("change",()=>{
        showEMA_LP=document.querySelector(".toggleLP[value='ema']").checked;
        showBoll_LP=document.querySelector(".toggleLP[value='boll']").checked;
        showRSI_LP=document.querySelector(".toggleLP[value='rsi']").checked;
        loadCharts50("180");
      });
    });
  </script>
</body>
</html>
