<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Painel Administrativo â€“ Ebook</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6fb;margin:0;color:#111}
header{background:#0b3d91;color:#fff;text-align:center;padding:14px 0}
.container{max-width:1000px;margin:20px auto;background:#fff;border-radius:8px;padding:20px;box-shadow:0 4px 14px rgba(0,0,0,0.08)}
input,button{padding:10px;margin:6px 0;width:100%;border-radius:6px;border:1px solid #ddd}
button{cursor:pointer;background:#0b3d91;color:#fff;border:none;font-weight:bold}
table{width:100%;border-collapse:collapse;margin-top:16px}
th,td{border:1px solid #eee;padding:8px;text-align:center}
th{background:#0b3d91;color:#fff}
.btn{background:#0b3d91;color:#fff;border:none;padding:6px 8px;border-radius:6px;cursor:pointer}
.search{margin-top:12px}
</style>
</head>
<body>
<header><h2>ðŸ“Š Painel Administrativo â€” Ebook</h2></header>

<div class="container">
  <div id="login">
    <label>UsuÃ¡rio</label>
    <input id="adminUser" placeholder="UsuÃ¡rio admin">
    <label>Senha</label>
    <input id="adminPass" type="password" placeholder="Senha">
    <button id="loginBtn">Entrar</button>
    <p id="loginMsg" style="color:red"></p>
  </div>

  <div id="panel" style="display:none">
    <div class="search">
      <input id="search" placeholder="Pesquisar nome, email ou telefone">
      <button id="refreshBtn" class="btn">Atualizar</button>
    </div>

    <table id="table">
      <thead>
        <tr>
          <th>ID</th><th>Nome</th><th>Email</th><th>Telefone</th>
          <th>Status</th><th>Data</th><th>AÃ§Ã£o</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
const webAppURL = "https://script.google.com/macros/s/AKfycbz8ad-CUSon007FRfMh7r1ZxbMWFA2G_kx8_tDk8Kf0D0Z7mTE3qz511g3VZvfJxAp5wQ/exec";

document.getElementById('loginBtn').addEventListener('click', ()=>{
  const user = document.getElementById('adminUser').value.trim();
  const pass = document.getElementById('adminPass').value.trim();
  if(user==='admin' && pass==='12345'){
    document.getElementById('login').style.display='none';
    document.getElementById('panel').style.display='block';
    loadData();
  }else{
    document.getElementById('loginMsg').innerText='UsuÃ¡rio ou senha incorretos!';
  }
});

document.getElementById('refreshBtn').addEventListener('click', loadData);

async function loadData(){
  try{
    const res = await fetch(webAppURL);
    const json = await res.json();
    if(json.status!=='success'){alert('Erro: '+json.message);return;}
    const tbody=document.getElementById('tbody');
    tbody.innerHTML='';
    json.data.forEach(item=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${item.id}</td>
        <td>${escapeHtml(item.name)}</td>
        <td>${escapeHtml(item.email)}</td>
        <td>${escapeHtml(item.phone)}</td>
        <td>${escapeHtml(item.paymentStatus)}</td>
        <td>${item.date?new Date(item.date).toLocaleString():''}</td>
        <td>${item.paymentStatus!=='Pago'
            ?`<button class="btn" onclick="markPaid(${item.id})">Marcar Pago</button>`
            :'âœ…'}</td>`;
      tbody.appendChild(tr);
    });
  }catch(err){alert('Erro: '+err);}
}

async function markPaid(id){
  try{
    const body={action:'updatePaymentStatus',id:id,paymentStatus:'Pago'};
    const res=await fetch(webAppURL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
    const json=await res.json();
    if(json.status==='success'){alert('Status atualizado!');loadData();}
    else alert('Erro: '+json.message);
  }catch(err){alert('Erro: '+err);}
}

document.getElementById('search').addEventListener('input',function(){
  const q=this.value.toLowerCase();
  document.querySelectorAll('#tbody tr').forEach(tr=>{
    tr.style.display=tr.innerText.toLowerCase().includes(q)?'':'none';
  });
});

function escapeHtml(s){return String(s||'').replace(/[&<>]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]));}
</script>
</body>
</html>
