<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Império Digital - Cadastro e Admin</title>
<style>
body{font-family:Arial,sans-serif;background:#111;color:#fff;margin:0;padding:0;}
.container{max-width:900px;margin:2rem auto;padding:1rem;background:#222;border-radius:12px;}
h1,h2,h3{color:#FFD700;text-align:center;}
input,button{padding:.8rem;margin:.3rem 0;width:100%;border-radius:6px;border:none;}
button{background:#FFD700;color:#000;font-weight:bold;cursor:pointer;}
button:hover{background:#FFAA00;color:#000;}
.notification{background:#333;color:#FFD700;padding:1rem;margin:1rem 0;border-radius:10px;display:none;}
.dashboard{display:none; margin-top:2rem;}
.dashboard table{width:100%;border-collapse:collapse;}
.dashboard th, .dashboard td{border:1px solid #555;padding:.5rem;text-align:left;}
.dashboard th{background:#222;color:#FFD700;}
</style>
</head>
<body>

<div class="container">
<h1>CONSTRUA SEU IMPÉRIO DIGITAL</h1>

<div id="notification" class="notification"></div>

<!-- Cadastro -->
<div id="cadastroSection">
<h3>Cadastro do Cliente</h3>
<input type="text" id="nome" placeholder="Nome Completo"/>
<input type="email" id="email" placeholder="Email"/>
<input type="text" id="telemovel" placeholder="Número de Telemóvel"/>
<button id="btnCadastro">Cadastrar</button>

<div id="linksEbook" style="display:none; margin-top:1rem;">
<h3>Entrega do Ebook</h3>
<p>📘 <a href="https://drive.google.com/file/d/1zAhbLDIdZgfASULt9_E2XBgNEW-j7DBQ/view?usp=sharing" target="_blank">Baixar Ebook</a></p>
<p>📝 <a href="https://drive.google.com/file/d/1vOwKjA9lNu8ohXOfp1UG1fOQsc4nGF0h/view?usp=sharing" target="_blank">Exercício Prático</a></p>
<p>💰 Preço: 99,9 MT</p>
<p>📲 Envie comprovativo para WhatsApp: <a id="whatsAppLink" href="#" target="_blank">Enviar</a></p>
</div>
</div>

<hr>

<!-- Login Admin -->
<div id="adminLoginSection">
<h3>Login do Administrador</h3>
<input type="text" id="adminUser" placeholder="Usuário"/>
<input type="password" id="adminPass" placeholder="Senha"/>
<button id="btnLogin">Entrar</button>
</div>

<!-- Dashboard -->
<div id="dashboardSection" class="dashboard">
<h2>Dashboard de Cadastros</h2>
<table id="dashboardTable">
<tr>
<th>Data</th><th>Nome</th><th>Email</th><th>Telemóvel</th><th>Pagamento</th>
</tr>
</table>
</div>
</div>

<script>
const webAppURL = "https://script.google.com/macros/s/AKfycbz8ad-CUSon007FRfMh7r1ZxbMWFA2G_kx8_tDk8Kf0D0Z7mTE3qz511g3VZvfJxAp5wQ/exec";

// Defina usuário e senha do admin
const ADMIN_USER = "admin";
const ADMIN_PASS = "123456";

function showNotification(msg){
  const notif = document.getElementById('notification');
  notif.innerText = msg;
  notif.style.display='block';
  setTimeout(()=>{notif.style.display='none';},4000);
}

// Cadastro cliente
document.getElementById('btnCadastro').addEventListener('click', async ()=>{
  const nome = document.getElementById('nome').value.trim();
  const email = document.getElementById('email').value.trim();
  const telemovel = document.getElementById('telemovel').value.trim();
  if(!nome || !email || !telemovel){ showNotification("Preencha todos os campos"); return; }

  try{
    const res = await fetch(webAppURL,{
      method:'POST',
      body: JSON.stringify({action:"cadastro", nome, email, telemovel})
    });
    const data = await res.json();
    if(data.status==="success"){
      showNotification(data.message);
      document.getElementById('linksEbook').style.display='block';
      document.getElementById('whatsAppLink').href = `https://wa.me/258877480775?text=${encodeURIComponent("Olá! Acabei de efetuar o pagamento de 99,9 MT do ebook 'CONSTRUA SEU IMPÉRIO DIGITAL'. Segue o comprovativo.")}`;
    } else showNotification(data.message);
  } catch(err){
    showNotification("Erro no cadastro: "+err.message);
  }
});

// Login admin
document.getElementById('btnLogin').addEventListener('click', ()=>{
  const user = document.getElementById('adminUser').value.trim();
  const pass = document.getElementById('adminPass').value.trim();
  if(user===ADMIN_USER && pass===ADMIN_PASS){
    showNotification("Login efetuado com sucesso!");
    document.getElementById('adminLoginSection').style.display='none';
    document.getElementById('dashboardSection').style.display='block';
    carregarDashboard();
  } else{
    showNotification("Usuário ou senha incorretos!");
  }
});

// Dashboard
async function carregarDashboard(){
  try{
    const res = await fetch(webAppURL+"?action=getRegistros");
    const registros = await res.json();
    const tbody = document.getElementById('dashboardTable');
    tbody.innerHTML='<tr><th>Data</th><th>Nome</th><th>Email</th><th>Telemóvel</th><th>Pagamento</th></tr>';
    registros.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML=`<td>${new Date(r.data).toLocaleString()}</td><td>${r.nome}</td><td>${r.email}</td><td>${r.telemovel}</td><td>${r.pagamento}</td>`;
      tbody.appendChild(tr);
    });
  } catch(err){
    showNotification("Erro ao carregar dashboard: "+err.message);
  }
}
</script>
</body>
</html>
